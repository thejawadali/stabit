generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model UserProfile {
  userId               String        @id @default(uuid())
  name                 String        @default("") @db.VarChar(255)
  email                String        @default("") @db.VarChar(255)
  avatarUrl            String        @default("") @db.VarChar(500)
  timezone             String        @default("UTC") @db.VarChar(50)
  language             String        @default("en") @db.VarChar(10)
  dateFormat           String        @default("MM/DD/YYYY") @db.VarChar(20)
  theme                Theme         @default(system)
  age                  Int           @default(0) @db.Int
  gender               Gender        @default(male)
  height               Int           @default(0) @db.Int
  isActive             Boolean       @default(true)
  personalGoals        String        @default("") @db.Text
  preferredTimeUnits   TimeUnit      @default(minutes)
  preferredCountUnits  CountUnit     @default(repetitions)
  defaultTrackingType  TrackingType  @default(duration)
  defaultGoalFrequency GoalFrequency @default(daily)
  autoSync             Boolean       @default(true)
  lastSyncTime         DateTime?     @db.Timestamp
  defaultDashboardView DashboardView @default(overview)
  showWelcomeMessage   Boolean       @default(true)
  
  notificationsEnabled Boolean       @default(false)

  // Notification Types
  enableReminders      Boolean       @default(true)
  enableMilestones     Boolean       @default(true)
  enableStreaks        Boolean       @default(true)
  
  // Reminder Settings
  defaultReminderTime  String?       @db.VarChar(20) @default("23:00 PM")
  reminderTone         ReminderTone  @default(gentle)
  smartReminders       Boolean       @default(true)
  
  // Delivery Channels
  inAppNotifications   Boolean       @default(true)
  emailNotifications   Boolean       @default(true)
  pushNotifications    Boolean       @default(true)
  
  // Quiet Hours
  quietHoursEnabled    Boolean       @default(false)
  quietHoursStart      String?       @db.VarChar(10)
  quietHoursEnd        String?       @db.VarChar(10)
  quietHoursDays       Json?         // Array of day strings: ["monday", "tuesday", ...]
  
  // Snooze Settings
  snoozeDuration       SnoozeDuration @default(oneHour)
  isSnoozed            Boolean       @default(false)
  snoozeUntil          DateTime?     @db.Timestamp

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model Category {
  id          String   @id @default(uuid())
  name        String   @db.VarChar(100)
  description String?  @db.Text
  color       String   @default("#3B82F6") @db.VarChar(7) // Hex color code
  icon        String?  @db.VarChar(50) // Icon name or identifier
  isActive    Boolean  @default(true)
  userId      String   @db.VarChar(36) // User who created the category
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relationships
  habits      Habit[]

  @@map("categories")
}

model Habit {
  id                    String            @id @default(uuid())
  name                  String            @db.VarChar(255)
  description           String            @default("") @db.Text
  icon                  String            @default("üéØ") @db.VarChar(50)
  recurrenceType        RecurrenceType    @default(daily)
  timeOfDay             String            @default("19:00") @db.VarChar(10)
  initialValue          Int          @default(0)
  difficultyRate        Int          @default(1)
  goalValue             Int          @default(0)
  goalMetric            String           @default("sessions") @db.VarChar(50)
  estimatedCompletionDate DateTime?       @db.Date
  status                HabitStatus       @default(active)
  isArchived            Boolean           @default(false)
  isActive              Boolean           @default(true)
  userId                String            @db.VarChar(36) // User who created the habit
  categoryId            String            @db.VarChar(36) // Category this habit belongs to
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt

  enableNotifications     Boolean           @default(true)
  reminderTimes          Json?

  // Relationships
  category              Category          @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  customFields          HabitCustomField[]
  rewards               HabitRewards[]
  habitLogs             HabitLogs[]
  habitStreak           HabitStreak[]
  habitMilestones       HabitMilestones[]
  notifications         Notifications[]
  @@map("habits")
}


model HabitCustomField {
  id            String        @id @default(uuid())
  habitId       String        @db.VarChar(36)
  title         String        @db.VarChar(255)
  type     FieldType
  options       Json?         // For select fields: ["Option1", "Option2"]
  isRequired    Boolean       @default(false)
  sortingOrder  Int           @default(0)
  createdAt     DateTime      @default(now())

  // Relationships
  habit         Habit         @relation(fields: [habitId], references: [id], onDelete: Cascade)

  @@map("habit_custom_fields")
}

model HabitRewards {
  id             String   @id @default(uuid())
  milestoneValue Int      @db.Int
  name           String   @db.VarChar(255)
  description    String   @db.Text
  icon           String   @default("üèÜ") @db.VarChar(50)
  sortingOrder  Int           @default(0)
  habitId        String   @db.VarChar(36)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relationships
  habit          Habit    @relation(fields: [habitId], references: [id], onDelete: Cascade)

  @@map("habit_rewards")
}


model HabitLogs {
  id String @id @default(uuid())
  habitId String @db.VarChar(36)
  userId String @db.VarChar(36)
  logDate DateTime @db.Date
  completionStatus CompletionStatus @default(completed)
  value Int @db.Int
  notes String? @db.Text
  completionTime DateTime? @db.Timestamp
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  habit Habit @relation(fields: [habitId], references: [id], onDelete: Cascade)

  @@map("habit_logs")
}

model HabitStreak {
  id String @id @default(uuid())
  habitId String @db.VarChar(36)
  userId String @db.VarChar(36)
  currentStreak Int @db.Int
  longestStreak Int @db.Int
  lastCompletionDate DateTime? @db.Date
  streakStartDate DateTime? @db.Date
  totalCompletions Int @db.Int
  totalSessions Int @db.Int
  completionRate Float @db.Float
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  habit Habit @relation(fields: [habitId], references: [id], onDelete: Cascade)

  @@map("habit_streaks")
}

model HabitMilestones {
  id String @id @default(uuid())
  habitId String @db.VarChar(36)
  userId String @db.VarChar(36)
  name String @db.VarChar(255)
  description String? @db.Text
  targetValue Float @db.Float
  targetMetric String @default("sessions") @db.VarChar(50)
  rewardName String? @db.VarChar(255)
  rewardDescription String? @db.Text
  rewardIcon String @default("üéâ") @db.VarChar(50)
  status MilestoneStatus @default(locked)
  currentProgress Float @default(0)
  achievedDate DateTime? @db.Date
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  habit Habit @relation(fields: [habitId], references: [id], onDelete: Cascade)

  @@map("habit_milestones")
}

model Notifications {
  id String @id @default(uuid())
  habitId String @db.VarChar(36)
  userId String @db.VarChar(36)
  type NotificationType @default(reminder)
  title String @db.VarChar(255)
  message String @db.Text
  isRead Boolean @default(false)
  sentAt DateTime @db.Timestamp
  readAt DateTime? @db.Timestamp
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  habit Habit @relation(fields: [habitId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model Achievements {
  id String @id @default(uuid())
  userId String @db.VarChar(36)
  name String @db.VarChar(255)
  description String? @db.Text
  icon String @default("üèÜ") @db.VarChar(50)
  category AchievementCategory @default(streak)
  criteria Json? // {"type": "streak", "value": 30, "habit_type": "any"}
  isActive Boolean @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt


  @@map("achievements")
}
enum AchievementCategory {
  streak
  completion
  consistency
  milestone
  special
}

enum NotificationType {
  reminder
  streakBreak
  milestoneAchieved
  encouragement
  system
}

enum MilestoneStatus {
  locked
  inProgress
  achieved
}

enum CompletionStatus {
  completed
  partial
  missed
  skipped
}

enum Theme {
  light
  dark
  system
}

enum Gender {
  male
  female
  other
}

enum TimeUnit {
  minutes
  hours
}

enum CountUnit {
  repetitions
  sessions
  times
  items
}

enum TrackingType {
  duration
  count
  both
}

enum GoalFrequency {
  daily
  weekly
  monthly
}

enum DashboardView {
  overview
  analytics
  calendar
  progress
}

enum ReminderTone {
  gentle
  motivational
  energetic
  calm
  custom
}

enum SnoozeDuration {
  fifteenMinutes
  oneHour
  twoHours
  fourHours
  eightHours
  twentyFourHours
}

enum RecurrenceType {
  daily
  weekly
  monthly
}

enum HabitStatus {
  active
  inactive
  completed
  paused
}

enum FieldType {
  text
  number
  select
  boolean
}
